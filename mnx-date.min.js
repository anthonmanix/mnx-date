!function(a){"use strict";function c(a,c,d,e,f,g,h){var j,k,m,n,i=new Date(a,c,-d),l=["<tbody>"];for(i=new Date(a,c,-i.getDay()),k=h("date")(e,"yyyy-MM-dd"),m=0;6>m;m+=1){for(l.push("<tr>"),n=0;7>n;n+=1)j=h("date")(i,"yyyy-MM-dd"),i>=f&&g>=i?l.push('<td data-date="',j,'" title="',h("date")(i,"fullDate"),'" class="',b,"-cal-day",i.getMonth()!=c?"-alt":j===k?"-sel":"",'">',i.getDate(),"</td>"):l.push("<td disabled></td>"),i.setDate(i.getDate()+1);l.push("</tr>")}return l.push("</tbody>"),l.join("")}function d(d,e){return{restrict:"A",require:"ngModel",link:function(f,g,h,i){function y(b){var e;if(b){if(e=+a.element(b.srcElement).attr("data-dir"),b.stopPropagation(),b.preventDefault(),k&&j.getMonth()+e<k.getMonth()||l&&j.getMonth()+e>l.getMonth())return;j.setMonth(j.getMonth()+e)}t.text(m.MONTH[j.getMonth()]+" "+j.getFullYear()),x.html(c(j.getFullYear(),j.getMonth(),o,i.$modelValue,k,l,d)),u.removeAttr("disabled"),k&&j.getMonth()-1<k.getMonth()&&u.attr("disabled",!0),v.removeAttr("disabled"),l&&j.getMonth()+1>l.getMonth()&&v.attr("disabled",!0)}function z(b){var c=a.element(b.srcElement).attr("data-date");b.stopPropagation(),b.preventDefault(),c&&(j=new Date(c),i.$setViewValue(d("date")(j,n)),i.$render())}var j,k,l,m=e.DATETIME_FORMATS,n=h.mnxFormat||m.shortDate,o=h.mnxFirstday||0,p=n.replace(/[^dmy]*([dmy])+[^dmy]*/gi,"$1").toLocaleLowerCase(),q=m.DAY.slice(o,7).concat(m.DAY.slice(0,o)),r=a.element('<div class="'+b+'-container"></div>'),s=a.element('<div class="'+b+'-head"></div>'),t=a.element('<div class="'+b+'-btn-mode"></div>'),u=a.element('<div class="'+b+'-btn-prev" data-dir="-1">&lt;</div>'),v=a.element('<div class="'+b+'-btn-next" data-dir="1">&gt;</div>'),w=a.element(['<table class="'+b+'-calendar">',"<thead><tr>",'<th title="',q[0],'">',q[0][0],"</th>",'<th title="',q[1],'">',q[1][0],"</th>",'<th title="',q[2],'">',q[2][0],"</th>",'<th title="',q[3],'">',q[3][0],"</th>",'<th title="',q[4],'">',q[4][0],"</th>",'<th title="',q[5],'">',q[5][0],"</th>",'<th title="',q[6],'">',q[6][0],"</th>","</tr></thead>","</table>"].join("")),x=a.element("<tbody></tbody>");f.$watch(h.mnxMin,function(a){k=new Date(a),k.setHours(0,0,0,0)}),f.$watch(h.mnxMax,function(a){l=new Date(a),l.setHours(0,0,0,0)}),i.$parsers.push(function(a){var b=a.match(/(\d+)/g);return b&&3===b.length?(i.$modelValue=new Date(+b[p.indexOf("y")],+b[p.indexOf("m")]-1,+b[p.indexOf("d")]),j=new Date(i.$modelValue),y(),new Date(i.$modelValue)):a}),i.$formatters.push(function(b){return a.isDate(b)&&(j=new Date(b),y(),b=d("date")(b,n)),b}),i.$validators.date=function(b){return a.isDate(b)},i.$validators.min=function(a){return!k||a>=k},i.$validators.max=function(a){return!l||l>=a},r.append(s.append(t).append(u).append(v)).append(w.append(x)),g.on("focus",function(){r.css({top:g[0].offsetTop+g[0].offsetHeight+"px",left:g[0].offsetLeft+"px"}),g.after(r),u.on("mousedown",y),v.on("mousedown",y),x.on("mousedown",z),j=i.$modelValue&&new Date(i.$modelValue)||new Date,j.setHours(0,0,0,0),y(),g.on("blur",function a(){g.off("blur",a),r.remove()})})}}}var b="mnx-date";d.$inject=["$filter","$locale"],a.module("mnxDate",[]).directive("mnxDate",d)}(window.angular);
